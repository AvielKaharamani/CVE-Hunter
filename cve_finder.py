import logging
from data_retriever import DataRetriever
from data_classes import LibraryCves


class CveFinder:
    @staticmethod
    def search_cves(requirements_path: str) -> list[LibraryCves]:
        """
        Function reads the third-party libraries and searches CVEs in them
        :param requirements_path: path to the requirements.txt file
        """
        with open(requirements_path, 'r') as file:
            file_data = file.readlines()

        results = []
        for line in file_data:
            library, version = line.strip().split('==')
            try:
                library_search_result = DataRetriever.extract_cves(library, version)
                results.append(library_search_result)
            except (RuntimeError, LookupError) as e:
                logging.error(e)

        return results
