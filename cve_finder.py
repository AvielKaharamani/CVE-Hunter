import logging
from typing import Generator
from data_retriever import DataRetriever
from data_classes import LibraryCves


class CveFinder:
    @staticmethod
    def search_cves(requirements_path: str) -> Generator[LibraryCves]:
        """
        Function reads the third-party libraries and searches CVEs in them
        :param requirements_path: path to the requirements.txt file
        """
        with open(requirements_path, 'r') as file:
            file_data = file.readlines()

        for line in file_data:
            library, version = line.strip().split('==')
            try:
                library_search_result = DataRetriever.extract_cves(library, version)
                yield library_search_result
            except (RuntimeError, LookupError) as e:
                logging.error(e)
